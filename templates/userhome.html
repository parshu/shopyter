{% block content %}
<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>klipiter.com | personal deal hunting engine | shopping assistant</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/bootstrap/docs/assets/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .scrollspy-example {  
		height: 1200px;  
		overflow: auto;  
		position: relative;  
	  }
    </style>
<style type="text/css">
#table-3 {
	
	background-color: #F9F9F9;
	width: 100%;
	-moz-border-radius: 3px;
	-webkit-border-radius: 3px;
	border-radius: 3px;
	font-family: Arial,"Bitstream Vera Sans",Helvetica,Verdana,sans-serif;
	color: #333;
}
#table-3 td, #table-3 th {
	border-top-color: white;
	border-bottom: 1px solid #DFDFDF;
	color: #555;
}
#table-3 th {
	text-shadow: rgba(255, 255, 255, 0.796875) 0px 1px 0px;
	font-family: Georgia,"Times New Roman","Bitstream Charter",Times,serif;
	font-weight: normal;
	padding: 7px 7px 8px;
	text-align: left;
	line-height: 1.3em;
	font-size: 14px;
}
#table-3 td {
	font-size: 12px;
	padding: 4px 7px 2px;
	vertical-align: top;
}
#online {
	color: red;
}
#in-store {
	color: brown;
}
#local {
	color: orange;
}

</style>   
    <link href="/bootstrap/docs/assets/css/bootstrap-responsive.css" rel="stylesheet">
    <link rel="stylesheet" href="/jquery-ui-1.8.21.custom/development-bundle/themes/base/jquery.ui.all.css">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/siteassets/img/faviconK.jpg">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/bootstrap/docs/assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/bootstrap/docs/assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="/bootstrap/docs/assets/ico/apple-touch-icon-57-precomposed.png">
	<script language="JavaScript" src="http://www.geoplugin.net/javascript.gp" type="text/javascript"></script>


  </head>

<body>
	<div class="navbar navbar-fixed-top">
    	<div class="navbar-inner">
        	<div class="container-fluid" style="padding-left:50px;padding-right:0px;">
          		<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            		<span class="icon-bar"></span>
            		<span class="icon-bar"></span>
            		<span class="icon-bar"></span>
          		</a>
          		<a class="brand" href="http://klipiter.com"><h1><span style="color:darkorange">klipiter.com </span><small>personal deal hunting engine | shopping assistant</small></h1></a>
          		<div class="nav-collapse">
            		<ul class="nav">
              		<!--<li class="active"><a href="#">Home</a></li>
              		<li><a href="#about">About</a></li>
              		<li><a href="#contact">Contact</a></li>-->
            		</ul>
            		<p class="navbar-text pull-right" style="margin-right: 60px;"><a onclick="bookmark('{{username}}\'s Klipiter page', document.URL);" href="">Bookmark</a> | <a href="/{{username}}">{{username}}'s</a> klip board | <a href="mailto:knopon@gmail.com">feedback</a></p>
          		</div><!--/.nav-collapse -->
        	</div>
		</div>
	</div>
    
    
   
	
		
		
		
	
   


	<div class="container-fluid" style="padding-top:25px;padding-left:50px;padding-right:0px;"><!--high level container for all body elements -->
	
		
					
					
		<div class="row-fluid"> <!--holds the row containing main parts, not footer -->
			
			
			<div class="span3"> <!--first column, holds query mainbox and add form -->
				
				<div id="queriesdiv" style="background:#F8F8F8;">
          			<!--This is where the queries in the mainbox will get rendered -->
            	</div>
            	
           	
            	<div id="addform" class="collapse in"><!-- Form to add new queries -->
            		{% if not return_user is sameas 1 %}
          		
          		<div class="label label-warning span12" style="margin-left:0px;min-height:10px;bottom-padding:5px;">
						<button class="close" data-dismiss="alert">×</button>
			   			Add it and forget it! We do all your work, every day.
				</div>
          		
				{% endif %}
            		<div class="well" >
						<div class="row-fluid">
							<div class="span12">
								<form id="add_query" class="form-inline">
									<input type="text" id="keyword" class="input-medium" placeholder="I am looking for..." required>&nbsp; around &nbsp;
									<input type="text" id="dollar_limit" onkeypress="return isNumberKey(event)"  class="input-micro" placeholder="$..." required>
									<button type="submit" class="btn btn-primary">Add</button>
              					</form>
              				</div>
              			</div>
              		</div><!--/.well -->
          		</div> <!-- end add form -->
          		
          		<div class="alert alert-info fade in" style="margin-left:0px;min-height:10px;bottom-padding:5px;">
					<form id="mod_location" class="form-inline" style="margin: 0 0 0px;">Your location: <strong><span id="userlocation">Not Known</span></strong> <a href="" style="color:darkorange;">edit</a></form>
				</div>
				<!--
				<input type="text" id="userlocation" class="input-medium" placeholder="loc..." required><button type="submit" class="btn btn-primary">Save</button>
				-->
          		
          		
				
				<div class="well" id="popularqueriesdiv" style="background:#F8F8F8;">
          			<!--This is where query recommendations will get rendered -->
            	</div>
            	<div id="tempfiltersdiv">
            	</div>
			</div><!--/span end column-->
        	
        
			<div class="span6" id="secondcol"> <!-- second column, holds deal results -->
          		<div class="row-fluid">
          			<ul class="nav nav-tabs" id="myTab">
          				
						<li class="active"><a href="#knopons" data-toggle="tab" onclick="revertBigMapChanges();">Results</a></li>
						<li><a href="#savedknopons" data-toggle="tab" onclick="revertBigMapChanges();execURL('/updatemetrics/{{username}}/increment/{&quot;savedtabviews&quot;:1}',true);">Saved Results</a></li>
						<li><a href="#localmaps" data-toggle="tab" onclick="makeBigMapChanges();execURL('/updatemetrics/{{username}}/increment/{&quot;bigmapviews&quot;:1}',true);">Local Results(Map)</a></li>
						<li class="dropdown" id="menu1">
							<a class="dropdown-toggle" data-toggle="dropdown" href="#menu1">
							Sort by
							<b class="caret"></b>
							</a>
							<ul class="dropdown-menu">
								<li><a href="#">Last found</a></li>
								<li><a href="#">Price</a></li>
								<li><a href="#">Value for money</a></li>
								<li><a href="#">Popularity</a></li>
								<li><a href="#">Distance</a></li>
								<li><a href="#">Time to recieve</a></li>

								
							</ul>
						</li>
						
					</ul>
					
					<div id="myTabContent" class="tab-content well">
						<div class="tab-pane fade" id="savedknopons">
							Loading...
						</div>
						<div class="tab-pane fade" id="localmaps" >
							Loading...
						</div>
						<div class="tab-pane fade active in scrollspy-example" data-target="#knopons" id="knopons" data-spy="scroll">
							
									<div id="dealresultsdiv"></div> <!-- This is where the deal results will get rendered -->
									
						</div>
						
					</div>
				</div> <!-- end second col -->
            </div>   
        
        	<div class="span3" id="thirdcol">  <!-- Third col holds filters and maps -->
        		
          		<div class="row-fluid" id="filtersdiv">
		  	    	
           		</div>
        
          	
          		<div class="row-fluid">  <!-- holds maps -->
          			<div class="span12" id="mapsdiv">
          			    
						<div id="mapresultsdiv"></div>
		  			</div>
		  		</div>  <!-- end maps -->
		  	</div><!-- end third column containing filters and maps-->
      	</div> <!-- end row containing all main body elements -->
      
      
      		<hr>
			
      		<footer>
        		<p>© klipiter.com 2012</p>
      		</footer>

    </div><!--/.fluid-container-->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/bootstrap/docs/assets/js/jquery.js"></script>
    
    
    <script language="javascript" type="text/javascript">

    // knopon.com custom JS functions follows
    
    function execURL(url, asynchronous){
		var ajaxRequest;  // The variable that makes Ajax possible!
		try{
			// Opera 8.0+, Firefox, Safari
			ajaxRequest = new XMLHttpRequest();
		} catch (e){
			// Internet Explorer Browsers
			try{
				ajaxRequest = new ActiveXObject("Msxml2.XMLHTTP");
			} catch (e) {
				try{
					ajaxRequest = new ActiveXObject("Microsoft.XMLHTTP");
				} catch (e){
					// Something went wrong
					alert("Your browser broke!");
					return false;
				}
			}
		}
		
		ajaxRequest.open("GET", url, asynchronous); 
		ajaxRequest.send(null); 
		
	}
    
    function renderProgressBar()
    {
    	var ajaxDisplay = document.getElementById("dealresultsdiv");
		ajaxDisplay.innerHTML = '<div class="progress progress-success" style="padding-top:30px;padding-left:30px;padding-right:30px;"><div class="bar" style="float: left; width: 0%; " data-percentage="100"></div></div>';
    
    }

	function doAnimation() {
			
			
			
			
			 $('.progress .bar').each(function() {
            var me = $(this);
            var perc = me.attr("data-percentage");
			
            //TODO: left and right text handling

            var current_perc = 0;

            var progress = setInterval(function() {
                if (current_perc>=perc) {
                    clearInterval(progress);
                } else {
                    current_perc +=5;
                    me.css('width', (current_perc)+'%');
                }
				
				var sourcesite = ['Amazon', 'Ebay','Craigslist', 'Walmart', 'Web'];
				var index = Math.floor(current_perc / 20);
                me.text('Scouring ' + sourcesite[index]);

            }, 200);

        	});
			
			
			

			

	
		}
		
		
	function bookmark(title, url) 
    {
       

        if (document.all)// Check if the browser is Internet Explorer
            window.external.AddFavorite(url, title);

        else if (window.sidebar) //If the given browser is Mozilla Firefox
            window.sidebar.addPanel(title, url, "");

        else if (window.opera && window.print) //If the given browser is Opera
        {
            var bookmark_element = document.createElement('a');
            bookmark_element.setAttribute('href', url);
            bookmark_element.setAttribute('title', title);
            bookmark_element.setAttribute('rel', 'sidebar');
            bookmark_element.click();
        }
    }

    
    function addQuery(url){
  
    	
    	execURL("/updatemetrics/{{username}}/increment/{\"queryadd\":1}",true);
		var ajaxRequest;  // The variable that makes Ajax possible!
		try{
			// Opera 8.0+, Firefox, Safari
			ajaxRequest = new XMLHttpRequest();
		} catch (e){
			// Internet Explorer Browsers
			try{
				ajaxRequest = new ActiveXObject("Msxml2.XMLHTTP");
			} catch (e) {
				try{
					ajaxRequest = new ActiveXObject("Microsoft.XMLHTTP");
				} catch (e){
					// Something went wrong
					alert("Your browser broke!");
					return false;
				}
			}
		}
		// Create a function that will receive data sent from the server
		ajaxRequest.onreadystatechange = function(){
			if(ajaxRequest.readyState == 4){
				  querycount = parseInt(document.getElementById("querytable").getAttribute("totalqueries")) + 1;
				  
				  renderQueryBox('/getqueries/{{username}}/' + querycount,'queriesdiv', 1);
				  var link = document.getElementById('query' + querycount);
				  if(link != undefined) {
					link.click();
				  } else {
				  	var link2 = document.getElementById('query1');
				  	if(link2 != undefined) {
						link2.click();
				  	}
				  	
				  }
		
				  
				  $('#keyword').val('');
				  $('#dollar_limit').val('');
				
			}
		}
		ajaxRequest.open("GET", url, true);
		ajaxRequest.send(null); 
		
	
		
	}
    
     function renderTextInDiv(text, divname){

		var ajaxDisplay = document.getElementById(divname);
		ajaxDisplay.innerHTML = text;
		
		
	}
    
    
    function renderURLinDiv(url, divname, asynchronous){
		var ajaxRequest;  // The variable that makes Ajax possible!
		try{
			// Opera 8.0+, Firefox, Safari
			ajaxRequest = new XMLHttpRequest();
		} catch (e){
			// Internet Explorer Browsers
			try{
				ajaxRequest = new ActiveXObject("Msxml2.XMLHTTP");
			} catch (e) {
				try{
					ajaxRequest = new ActiveXObject("Microsoft.XMLHTTP");
				} catch (e){
					// Something went wrong
					alert("Your browser broke!");
					return false;
				}
			}
		}
		// Create a function that will receive data sent from the server
		ajaxRequest.onreadystatechange = function(){
			if(ajaxRequest.readyState == 4){
				var ajaxDisplay = document.getElementById(divname);
				ajaxDisplay.innerHTML = ajaxRequest.responseText;
			}
		}
		ajaxRequest.open("GET", url, asynchronous); 
		ajaxRequest.send(null); 
		
	}
	function indicateSaved(url, divname, asynchronous){
		var ajaxRequest;  // The variable that makes Ajax possible!
		try{
			// Opera 8.0+, Firefox, Safari
			ajaxRequest = new XMLHttpRequest();
		} catch (e){
			// Internet Explorer Browsers
			try{
				ajaxRequest = new ActiveXObject("Msxml2.XMLHTTP");
			} catch (e) {
				try{
					ajaxRequest = new ActiveXObject("Microsoft.XMLHTTP");
				} catch (e){
					// Something went wrong
					alert("Your browser broke!");
					return false;
				}
			}
		}
		// Create a function that will receive data sent from the server
		ajaxRequest.onreadystatechange = function(){
			if(ajaxRequest.readyState == 4){
				var ajaxDisplay = document.getElementById(divname);
				ajaxDisplay.innerHTML = ajaxRequest.responseText;
				ajaxDisplay.setAttribute("style","background-color:lightgreen; background-image: -moz-linear-gradient(center top , lightgreen, lightgreen);");
			}
		}
		ajaxRequest.open("GET", url, asynchronous); 
		ajaxRequest.send(null); 
		
	}
	
	function makeBigMapChanges()
	{
		/*var ajaxDisplay = document.getElementById("filtersdiv");
		var filtercontent = ajaxDisplay.innerHTML;
		ajaxDisplay = document.getElementById("tempfiltersdiv");
		ajaxDisplay.innerHTML = filtercontent;*/
		ajaxDisplay = document.getElementById("thirdcol");
		ajaxDisplay.setAttribute("class","span0");
		ajaxDisplay = document.getElementById("secondcol");
		ajaxDisplay.setAttribute("class","span9");
	}
	function revertBigMapChanges()
	{
		
		/*ajaxDisplay = document.getElementById("tempfiltersdiv");
		ajaxDisplay.innerHTML = "";*/
		ajaxDisplay = document.getElementById("thirdcol");
		ajaxDisplay.setAttribute("class","span3");
		ajaxDisplay = document.getElementById("secondcol");
		ajaxDisplay.setAttribute("class","span6");
	}
	function saveDeal(dealid, username)
    {
    	indicateSaved('/savedeal/' + dealid + '/' + username, dealid, true);
    }
    function unsaveDeal(dealid, username)
    {
    	renderURLinDiv('/unsavedeal/' + dealid + '/' + username, 'tn' + dealid, true);
    }
	
	function highlightQuery(id) {
		
		var activeele = document.getElementById("activequerytr");
		if(activeele != null) {
			activeele.removeAttribute("style");
			var realid = activeele.getAttribute("realid");
			activeele.setAttribute("id", realid);
		}
		var clickedele = document.getElementById(id);
		clickedele.setAttribute("id", "activequerytr");
		clickedele.setAttribute("style", "background:lightgrey;");
		
	}
	
	function renderPriceSlider(loopid) {
		var ajaxDisplay = document.getElementById(loopid);
		var pricemin = parseInt(ajaxDisplay.getAttribute("pmn"));
		var pricemax = parseInt(ajaxDisplay.getAttribute("pmx"));
		var pricelow = parseInt(ajaxDisplay.getAttribute("pl"));
		var pricehigh = parseInt(ajaxDisplay.getAttribute("ph"));
		$(function() {
			$( "#slider-range" ).slider({
				range: true,
				min: pricemin,
				max: pricemax,
				values: [ pricelow, pricehigh ],
				slide: function( event, ui ) {
					$( "#amount" ).val( "$" + ui.values[ 0 ] + " - $" + ui.values[ 1 ] );
					
				},
				stop: function( event, ui ) {
					//ui.values[0] & ui.values[1]
					var ele = document.getElementById("filtersholder");
					var qid = ele.getAttribute("qid");
					execURL('/updatequerypricerange/' + qid + '/' + ui.values[0] + '/' + ui.values[1], false);
					var lpid = ele.getAttribute("loopid");
					var linkele = document.getElementById(lpid);
					linkele.setAttribute("pl",ui.values[0]);
					linkele.setAttribute("ph",ui.values[1]);
					linkele.click();
					execURL("/updatemetrics/{{username}}/increment/{\"filtersused\":1}",true);
					
										
					
				}
			});
			$( "#amount" ).val( "$" + $( "#slider-range" ).slider( "values", 0 ) +
				" - $" + $( "#slider-range" ).slider( "values", 1 ) );
		});
	
	}
	
	function renderDaysSlider(loopid) {
		var ajaxDisplay = document.getElementById(loopid);
		var days = parseInt(ajaxDisplay.getAttribute("df"));
		$(function() {
			$( "#slider-range-min" ).slider({
				range: "min",
				value: days,
				min: 1,
				max: 21,
				slide: function( event, ui ) {
					$( "#days" ).val( ui.value + " days ago" );
				},
				stop: function( event, ui ) {
					var ele = document.getElementById("filtersholder");
					var qid = ele.getAttribute("qid");
					execURL('/updatequerydays/' + qid + '/' + ui.value, false);
					var lpid = ele.getAttribute("loopid");
					var linkele = document.getElementById(lpid);
					linkele.setAttribute("df",ui.value);
					linkele.click();
					execURL("/updatemetrics/{{username}}/increment/{\"filtersused\":1}",true);											
					
				}
			});
			$( "#days" ).val( $( "#slider-range-min" ).slider( "value" ) + " days ago");
		});
	}
	
	function saveFilter(queryid, eleid, filtername) {
		var ele = document.getElementById(eleid);
		var classval = ele.getAttribute("class");
		var filtersele = document.getElementById("filtersholder");
		var selectedbuttons = filtersele.getAttribute("selectedbuttons");
		if(classval == "btn") {
			selectedbuttons = selectedbuttons + "," + filtername;
		}
		else {
			selectedbuttons = selectedbuttons.replace("," + filtername, "");
		}
		filtersele.setAttribute("selectedbuttons", selectedbuttons);
		if(selectedbuttons == "") {
			selectedbuttons = "-1";
		}
		execURL('/updatequeryfilters/' + queryid + '/' + selectedbuttons, false);
		var lpid = filtersele.getAttribute("loopid");
		var linkele = document.getElementById(lpid);
		linkele.click();
		
	
	}
    
    //noOfQueries - unused as of now
	//queryBoxDivname - Name of the  query box div
	//queryBoxURL - URL that needs to be requested for the query box html. This is rendered in queryBoxDivname
    
    function renderQueryBox(queryBoxURL, queryBoxDivname, noOfQueries){
		var ajaxRequest;  // The variable that makes Ajax possible!
		try{
			// Opera 8.0+, Firefox, Safari
			ajaxRequest = new XMLHttpRequest();
		} catch (e){
			// Internet Explorer Browsers
			try{
				ajaxRequest = new ActiveXObject("Msxml2.XMLHTTP");
			} catch (e) {
				try{
					ajaxRequest = new ActiveXObject("Microsoft.XMLHTTP");
				} catch (e){
					// Something went wrong
					alert("Your browser broke!");
					return false;
				}
			}
		}
		// Create a function that will receive data sent from the server
		ajaxRequest.onreadystatechange = function(){
			if(ajaxRequest.readyState == 4){
				var ajaxDisplay = document.getElementById(queryBoxDivname);
				ajaxDisplay.innerHTML = ajaxRequest.responseText;
			}
		}
		ajaxRequest.open("GET", queryBoxURL, false); // false: synchronous call to eliminate weird UI behavior
		ajaxRequest.send(null); 
		
	}
    
    //noOfQueries - unused as of now
	//queryIndex - Index of the selected query. Used for highlighting
	//dealResultsDivname - Name of the  deal results div
	//dealResultsURL - URL that needs to be requested for the deal results html. This is rendered in queryBoxDivname
	
	function renderDealResults(dealResultsURL, dealResultsDivname, queryIndex, doRenderQueryBox, noOfQueries){
		var ajaxRequest;  // The variable that makes Ajax possible!
		try{
			// Opera 8.0+, Firefox, Safari
			ajaxRequest = new XMLHttpRequest();
		} catch (e){
			// Internet Explorer Browsers
			try{
				ajaxRequest = new ActiveXObject("Msxml2.XMLHTTP");
			} catch (e) {
				try{
					ajaxRequest = new ActiveXObject("Microsoft.XMLHTTP");
				} catch (e){
					// Something went wrong
					alert("Your browser broke!");

					return false;
				}
			}
		}
		// function that will receive data sent from the server
		ajaxRequest.onreadystatechange = function(){
			if(ajaxRequest.readyState == 4){
				var ajaxDisplay = document.getElementById(dealResultsDivname);
				ajaxDisplay.innerHTML = ajaxRequest.responseText;
			}
		}
		ajaxRequest.open("GET", dealResultsURL, false); // false: synchronous call to eliminate weird UI behavior
		ajaxRequest.send(null); 
		
		
	}
	
	function renderMapResults(dealResultsURL, dealResultsDivname, queryIndex, doRenderQueryBox, noOfQueries, height){
		
		var ajaxDisplay = document.getElementById(dealResultsDivname);
		ajaxDisplay.innerHTML = '<iframe width="100%" height="' + height + '" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="' + dealResultsURL  + '"></iframe>';
	
		
		
	}
	
	//url - URL containing information to delete a query
	// highlightIndex - highlighted query
	// keyword/dollarlimit pair used as primary key contained in url
	
	function removeQuery(url,highlightIndex, queryid, price_max, price_min, price_high, price_low, daysfilter)
	{
		var ajaxRequest;  // The variable that makes Ajax possible!
		
		try{
			// Opera 8.0+, Firefox, Safari
			ajaxRequest = new XMLHttpRequest();
		} catch (e){
			// Internet Explorer Browsers
			try{
				ajaxRequest = new ActiveXObject("Msxml2.XMLHTTP");
			} catch (e) {
				try{
					ajaxRequest = new ActiveXObject("Microsoft.XMLHTTP");
				} catch (e){
					// Something went wrong
					alert("Your browser broke!");
					return false;
				}
			}
		}
		
		
		ajaxRequest.open("GET", url, false); // false: synchronous call to eliminate weird UI behavior
		ajaxRequest.send(null); 
		
		// Re render query box and deal results after deleting a query. Immediately see results of action
		renderQueryBox('/getqueries/{{username}}/' + highlightIndex,'queriesdiv', 1);
       	var link = document.getElementById('query1');
       	if(link != undefined) {
	  		link.click();
	  		
	  	}
	  	else{
	  		var ajaxDisplay;
	  		divs = ['dealresultsdiv', 'filtersdiv', 'savedknopons', 'mapresultsdiv', 'localmaps'];
	  		for each (var div in divs) {
	  		 	ajaxDisplay = document.getElementById(div);
				ajaxDisplay.innerHTML = "";
			}
	  	}
       
		
	}
	
	// Function to validate that a typed char is a number or . (used to validate entry in $box
	function isNumberKey(evt)
    {
          var charCode = (evt.which) ? evt.which : event.keyCode
          if (charCode > 31 
            && (charCode < 48 || charCode > 57))
             return false;

          return true;
    }


	function renderLocationBox() {
	
		{% if userinfo['haslocation'] is defined %}
			var city = '{{userinfo['city']}}';
			var state = '{{userinfo['state']}}';
		
		{% else %}
			var city = geoplugin_city();
			var state = geoplugin_regionCode();
			var lat = geoplugin_latitude();
			var longit = geoplugin_longitude();
			execURL('/updatelocation/{{username}}/' + city + '/' + state + '/' + lat + '/' + longit , true);
			
		
		
		{% endif %}
		ajaxDisplay = document.getElementById('userlocation');
		ajaxDisplay.innerHTML = city + ', ' + state;
	
	
	}

      
      // Display the querybox with 1st item highlighed and render deals for it when user first visits the page  
      renderQueryBox('/getqueries/{{username}}/1','queriesdiv', 1);	
      
      var link = document.getElementById('query1');
	  if(link != undefined) {
	  		link.click();
	  }
	 
	 
	  
	  
	  
	  renderLocationBox();
      renderQueryBox('/getpopularqueries/{{username}}/1','popularqueriesdiv', 1);
     
	
      
     
      // Functions to handle submit of a new query
      $("#add_query").bind("submit", function(e){
     	 e.preventDefault();
      });
      
      $('#add_query').submit(function() {
      	  renderProgressBar();
      	  doAnimation();   	  
      	  
	      var keyword = $("#keyword").val();
	      var dollar_limit = parseInt($("#dollar_limit").val());
	      var price_high = dollar_limit + parseInt({{PRICE_HIGH_PER}} * dollar_limit);
		  var price_low = dollar_limit - parseInt({{PRICE_LOW_PER}} * dollar_limit);
		  var price_max = parseInt({{PRICE_MAX_PER}} * price_high);
		  var price_min = parseInt(price_low / {{PRICE_MIN_PER}});
	      addQuery('/addquery/' + keyword + '/' + dollar_limit);
	      

	      

      });
      
      function recordOutboundLink(link) {
    		_gaq.push(['_trackEvent', 'deals', 'click', 'knoponpage']);
    		setTimeout('document.location = "' + link.href + '"', 100);
  	  }
      
    
      execURL("/updatemetrics/{{username}}/increment/{\"visits\":1}",true);
    
    </script>
    
    <script src="/bootstrap/docs/assets/js/bootstrap-transition.js"></script>
    <script src="/bootstrap/docs/assets/js/bootstrap-alert.js"></script>
    <script src="/bootstrap/docs/assets/js/bootstrap-modal.js"></script>
    <script src="/bootstrap/docs/assets/js/bootstrap-dropdown.js"></script>

    <script src="/bootstrap/docs/assets/js/bootstrap-scrollspy.js"></script>
    <script src="/bootstrap/docs/assets/js/bootstrap-tab.js"></script>
    <script src="/bootstrap/docs/assets/js/bootstrap-tooltip.js"></script>
    <script src="/bootstrap/docs/assets/js/bootstrap-popover.js"></script>
    <script src="/bootstrap/docs/assets/js/bootstrap-button.js"></script>
    <script src="/bootstrap/docs/assets/js/bootstrap-collapse.js"></script>

    <script src="/bootstrap/docs/assets/js/bootstrap-carousel.js"></script>
    <script src="/bootstrap/docs/assets/js/bootstrap-typeahead.js"></script>

		  
	<script src="/jquery-ui-1.8.21.custom/development-bundle/ui/jquery.ui.core.js"></script>
	<script src="/jquery-ui-1.8.21.custom/development-bundle/ui/jquery.ui.widget.js"></script>
	<script src="/jquery-ui-1.8.21.custom/development-bundle/ui/jquery.ui.mouse.js"></script>
	<script src="/jquery-ui-1.8.21.custom/development-bundle/ui/jquery.ui.slider.js"></script>


</body></html>
 {% endblock %}	