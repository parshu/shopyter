{% block content %}
<!DOCTYPE html>
<html lang="en"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>klipiter.com | personal deal hunting engine | shopping assistant</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="/bootstrap/docs/assets/css/bootstrap.css" rel="stylesheet">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }
      .scrollspy-example {  
		height: 1200px;  
		overflow: auto;  
		position: relative;  
	  }
    </style>
<style type="text/css">
#table-3 {
	
	background-color: #F9F9F9;
	width: 100%;
	-moz-border-radius: 3px;
	-webkit-border-radius: 3px;
	border-radius: 3px;
	font-family: Arial,"Bitstream Vera Sans",Helvetica,Verdana,sans-serif;
	color: #333;
}
#table-3 td, #table-3 th {
	border-top-color: white;
	border-bottom: 1px solid #DFDFDF;
	color: #555;
}
#table-3 th {
	text-shadow: rgba(255, 255, 255, 0.796875) 0px 1px 0px;
	font-family: Georgia,"Times New Roman","Bitstream Charter",Times,serif;
	font-weight: normal;
	padding: 7px 7px 8px;
	text-align: left;
	line-height: 1.3em;
	font-size: 14px;
}
#table-3 td {
	font-size: 12px;
	padding: 4px 7px 2px;
	vertical-align: top;
}
#online {
	color: red;
}
#in-store {
	color: brown;
}
#local {
	color: orange;
}

</style>   
    <link href="/bootstrap/docs/assets/css/bootstrap-responsive.css" rel="stylesheet">
    <link rel="stylesheet" href="/jquery-ui-1.8.21.custom/development-bundle/themes/base/jquery.ui.all.css">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/siteassets/img/faviconK.jpg">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/bootstrap/docs/assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/bootstrap/docs/assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="/bootstrap/docs/assets/ico/apple-touch-icon-57-precomposed.png">

	<script type="text/javascript">
	 
	 	

	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-30448786-1']);
	  _gaq.push(['_trackPageview']);
	
	  (function() {
	    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();


	var totalqueries = {{qlen}};
	</script>

  </head>

<body>
	<div class="navbar navbar-fixed-top">
    	<div class="navbar-inner">
        	<div class="container-fluid">
          		<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            		<span class="icon-bar"></span>
            		<span class="icon-bar"></span>
            		<span class="icon-bar"></span>
          		</a>
          		<a class="brand" href="http://klipiter.com"><h1><span style="color:darkorange">klipiter.com </span><small>personal deal hunting engine | shopping assistant</small></h1></a>
          		<div class="nav-collapse">
            		<ul class="nav">
              		<!--<li class="active"><a href="#">Home</a></li>
              		<li><a href="#about">About</a></li>
              		<li><a href="#contact">Contact</a></li>-->
            		</ul>
            		<p class="navbar-text pull-right" style="margin-right: 60px;"><a href="/{{username}}">{{username}}'s</a> klip board | <a href="mailto:knopon@gmail.com">feedback</a></p>
          		</div><!--/.nav-collapse -->
        	</div>
		</div>
	</div>
    
    
    
    <div class="row">
    	<div class="span4">&nbsp;</div>
    	<div class="span8">&nbsp;</div>
    </div>
	<div class="row">
    	<div class="span4">&nbsp;</div>
    	<div class="span8">&nbsp;</div>
    </div>


	<div class="container-fluid"><!--high level container for all body elements -->
		<div class="row-fluid"> <!--holds the row containing main parts, not footer -->
			
			<div class="span3"> <!--first column, holds query mainbox and add form -->
				
				<div class="well" id="queriesdiv" style="background:#F8F8F8;">
          			<!--This is where the queries in the mainbox will get rendered -->
            	</div>
            	
           	
            	<div id="addform" class="collapse in"><!-- Form to add new queries -->
            		<div class="well" >
						<div class="row-fluid">
							<div class="span12">
								<form id="add_query" class="form-inline">
									<input type="text" id="keyword" class="input-medium" placeholder="I am looking for..." required>&nbsp; around &nbsp;
									<input type="text" id="dollar_limit" onkeypress="return isNumberKey(event)"  class="input-micro" placeholder="$..." required>
									<button type="submit" class="btn btn-primary">Add</button>
              					</form>
              				</div>
              			</div>
              		</div><!--/.well -->
          		</div> <!-- end add form -->
          		<div class="alert alert-info">
							<button class="close" data-dismiss="alert">×</button>
							Add it and forget it! We do all your work. We will email you when we find good stuff. You can also visit your homepage anytime for updates.
				</div>
				
				<div class="well" id="popularqueriesdiv" style="background:#F8F8F8;">
          			<!--This is where query recommendations will get rendered -->
            	</div>
			</div><!--/span end column-->
        
        
			<div class="span6"> <!-- second column, holds deal results -->
          		<div class="row-fluid">
          			<ul class="nav nav-tabs" id="myTab">
          				
						<li class="active"><a href="#knopons" data-toggle="tab">Results</a></li>
						<li><a href="#savedknopons" data-toggle="tab">Saved Results</a></li>
						<li class="dropdown" id="menu1">
							<a class="dropdown-toggle" data-toggle="dropdown" href="#menu1">
							Sort by
							<b class="caret"></b>
							</a>
							<ul class="dropdown-menu">
								<li><a href="#">Last found</a></li>
								<li><a href="#">Price</a></li>
								<li><a href="#">Awesomeness</a></li>
								
							</ul>
						</li>
						
					</ul>
					
					<div id="myTabContent" class="tab-content well">
						<div class="tab-pane fade" id="savedknopons">
							Saved deals
						</div>
						<div class="tab-pane fade active in scrollspy-example" data-target="#knopons" id="knopons" data-spy="scroll">
							
									<div id="dealresultsdiv"></div> <!-- This is where the deal results will get rendered -->
									
						</div>
						
					</div>
				</div> <!-- end second col -->
            </div>   
        
        	<div class="span3">  <!-- Third col holds filters and maps -->
          		<div class="row-fluid well" id="filtersdiv">
		  	    	
           		</div>
        
          	
          		<div class="row-fluid well">  <!-- holds maps -->
          			<div class="span12" id="mapsdiv">
          			    
						<div id="mapresultsdiv"></div>
		  			</div>
		  		</div>  <!-- end maps -->
		  	</div><!-- end third column containing filters and maps-->
      	</div> <!-- end row containing all main body elements -->
      
      
      		<hr>
			
      		<footer>
        		<p>© klipiter.com 2012</p>
      		</footer>

    </div><!--/.fluid-container-->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/bootstrap/docs/assets/js/jquery.js"></script>
    
    
    <script language="javascript" type="text/javascript">

    // knopon.com custom JS functions follows
    
    function renderProgressBar()
    {
    	var ajaxDisplay = document.getElementById("dealresultsdiv");
		ajaxDisplay.innerHTML = '<div class="progress progress-striped active" style="width: 400px; margin-left: auto; margin-right: auto;"><div class="bar" style="width: 0%;"></div></div>';
    
    }

	function doAnimation() {
			var sourcesite = ['Amazon','Amazon', 'Ebay','Ebay', 'Craigslist', 'Craigslist', 'Walmart', 'Walmart', 'Other', 'Other'];
			
			var progress = setInterval(function() {
				var $bar = $('.bar');
				
				if ($bar.width()==400) {
					clearInterval(progress);
					$('.progress').removeClass('active');
				} else {
					$bar.width($bar.width()+40);
				}
				$bar.text(sourcesite[$bar.width()/40] + " " + $bar.width()/4 + "%");
				//renderDealResults('/getdeals/HD camcorder/400/1/' + $bar.width()/20 + '/getdeals.html','dealresultsdiv', -1, 0, 1 );
				
			}, 100);
	
		}
    
    function addQuery(url){
  
    	
    	
		var ajaxRequest;  // The variable that makes Ajax possible!
		try{
			// Opera 8.0+, Firefox, Safari
			ajaxRequest = new XMLHttpRequest();
		} catch (e){
			// Internet Explorer Browsers
			try{
				ajaxRequest = new ActiveXObject("Msxml2.XMLHTTP");
			} catch (e) {
				try{
					ajaxRequest = new ActiveXObject("Microsoft.XMLHTTP");
				} catch (e){
					// Something went wrong
					alert("Your browser broke!");
					return false;
				}
			}
		}
		// Create a function that will receive data sent from the server
		ajaxRequest.onreadystatechange = function(){
			if(ajaxRequest.readyState == 4){
				
			}
		}
		ajaxRequest.open("GET", url, false);
		ajaxRequest.send(null); 
	
		
	}
    
    
    
    
    function renderURLinDiv(url, divname, asynchronous){
		var ajaxRequest;  // The variable that makes Ajax possible!
		try{
			// Opera 8.0+, Firefox, Safari
			ajaxRequest = new XMLHttpRequest();
		} catch (e){
			// Internet Explorer Browsers
			try{
				ajaxRequest = new ActiveXObject("Msxml2.XMLHTTP");
			} catch (e) {
				try{
					ajaxRequest = new ActiveXObject("Microsoft.XMLHTTP");
				} catch (e){
					// Something went wrong
					alert("Your browser broke!");
					return false;
				}
			}
		}
		// Create a function that will receive data sent from the server
		ajaxRequest.onreadystatechange = function(){
			if(ajaxRequest.readyState == 4){
				var ajaxDisplay = document.getElementById(divname);
				ajaxDisplay.innerHTML = ajaxRequest.responseText;
			}
		}
		ajaxRequest.open("GET", url, asynchronous); 
		ajaxRequest.send(null); 
		
	}
	
	function renderPriceSlider(pricemax, pricemin, pricehigh, pricelow) {
		$(function() {
			$( "#slider-range" ).slider({
				range: true,
				min: pricemin,
				max: pricemax,
				values: [ pricelow, pricehigh ],
				slide: function( event, ui ) {
					$( "#amount" ).val( "$" + ui.values[ 0 ] + " - $" + ui.values[ 1 ] );
				}
			});
			$( "#amount" ).val( "$" + $( "#slider-range" ).slider( "values", 0 ) +
				" - $" + $( "#slider-range" ).slider( "values", 1 ) );
		});
	
	}
	
	function renderDaysSlider(daysfilter) {
		$(function() {
			$( "#slider-range-min" ).slider({
				range: "min",
				value: daysfilter,
				min: 1,
				max: 21,
				slide: function( event, ui ) {
					$( "#days" ).val( ui.value + " days ago" );
				}
			});
			$( "#days" ).val( $( "#slider-range-min" ).slider( "value" ) + " days ago");
		});
	}
    
    //noOfQueries - unused as of now
	//queryBoxDivname - Name of the  query box div
	//queryBoxURL - URL that needs to be requested for the query box html. This is rendered in queryBoxDivname
    
    function renderQueryBox(queryBoxURL, queryBoxDivname, noOfQueries){
		var ajaxRequest;  // The variable that makes Ajax possible!
		try{
			// Opera 8.0+, Firefox, Safari
			ajaxRequest = new XMLHttpRequest();
		} catch (e){
			// Internet Explorer Browsers
			try{
				ajaxRequest = new ActiveXObject("Msxml2.XMLHTTP");
			} catch (e) {
				try{
					ajaxRequest = new ActiveXObject("Microsoft.XMLHTTP");
				} catch (e){
					// Something went wrong
					alert("Your browser broke!");
					return false;
				}
			}
		}
		// Create a function that will receive data sent from the server
		ajaxRequest.onreadystatechange = function(){
			if(ajaxRequest.readyState == 4){
				var ajaxDisplay = document.getElementById(queryBoxDivname);
				ajaxDisplay.innerHTML = ajaxRequest.responseText;
			}
		}
		ajaxRequest.open("GET", queryBoxURL, false); // false: synchronous call to eliminate weird UI behavior
		ajaxRequest.send(null); 
		
	}
    
    //noOfQueries - unused as of now
	//queryIndex - Index of the selected query. Used for highlighting
	//dealResultsDivname - Name of the  deal results div
	//dealResultsURL - URL that needs to be requested for the deal results html. This is rendered in queryBoxDivname
	
	function renderDealResults(dealResultsURL, dealResultsDivname, queryIndex, doRenderQueryBox, noOfQueries){
		var ajaxRequest;  // The variable that makes Ajax possible!
		try{
			// Opera 8.0+, Firefox, Safari
			ajaxRequest = new XMLHttpRequest();
		} catch (e){
			// Internet Explorer Browsers
			try{
				ajaxRequest = new ActiveXObject("Msxml2.XMLHTTP");
			} catch (e) {
				try{
					ajaxRequest = new ActiveXObject("Microsoft.XMLHTTP");
				} catch (e){
					// Something went wrong
					alert("Your browser broke!");

					return false;
				}
			}
		}
		// function that will receive data sent from the server
		ajaxRequest.onreadystatechange = function(){
			if(ajaxRequest.readyState == 4){
				var ajaxDisplay = document.getElementById(dealResultsDivname);
				ajaxDisplay.innerHTML = ajaxRequest.responseText;
			}
		}
		ajaxRequest.open("GET", dealResultsURL, false); // false: synchronous call to eliminate weird UI behavior
		ajaxRequest.send(null); 
		
		// if something gets clicked, this is a hacky way of re rendering query box to change the highlighting to the clicked query. gets called from getdeals.html
		if(doRenderQueryBox == 1)
		{
			renderQueryBox('/getqueries/{{username}}/' + queryIndex,'queriesdiv', noOfQueries);
		}
		else if(doRenderQueryBox == 2)
		{
			renderQueryBox('/getpopularqueries/{{username}}/' + queryIndex,'popularqueriesdiv', noOfQueries);
			
		}
		
	}
	
	function renderMapResults(dealResultsURL, dealResultsDivname, queryIndex, doRenderQueryBox, noOfQueries){
		
		var ajaxDisplay = document.getElementById(dealResultsDivname);
		ajaxDisplay.innerHTML = '<iframe width="100%" height="500" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="' + dealResultsURL  + '"></iframe>';
	
		
		
	}
	
	//url - URL containing information to delete a query
	// highlightIndex - highlighted query
	// keyword/dollarlimit pair used as primary key contained in url
	
	function removeQuery(url,highlightIndex){
		var ajaxRequest;  // The variable that makes Ajax possible!
		
		try{
			// Opera 8.0+, Firefox, Safari
			ajaxRequest = new XMLHttpRequest();
		} catch (e){
			// Internet Explorer Browsers
			try{
				ajaxRequest = new ActiveXObject("Msxml2.XMLHTTP");
			} catch (e) {
				try{
					ajaxRequest = new ActiveXObject("Microsoft.XMLHTTP");
				} catch (e){
					// Something went wrong
					alert("Your browser broke!");
					return false;
				}
			}
		}
		
		
		ajaxRequest.open("GET", url, false); // false: synchronous call to eliminate weird UI behavior
		ajaxRequest.send(null); 
		
		// Re render query box and deal results after deleting a query. Immediately see results of action
		renderQueryBox('/getqueries/{{username}}/' + highlightIndex,'queriesdiv', 1);
        renderDealResults('/getdeals/{{username}}/-1/-1/-1/1/30/getdeals.html','dealresultsdiv', -1, 0, 1 );
        renderMapResults('/getdeals/{{username}}/-1/-1/-1/1/30/getmap.html','mapresultsdiv', -1, 0, 1 );

		totalqueries = totalqueries - 1;
       
		
	}
	
	// Function to validate that a typed char is a number or . (used to validate entry in $box
	function isNumberKey(evt)
    {
          var charCode = (evt.which) ? evt.which : event.keyCode
          if (charCode > 31 
            && (charCode < 48 || charCode > 57))
             return false;

          return true;
    }


      
      // Display the querybox with 1st item highlighed and render deals for it when user first visits the page  
      renderQueryBox('/getqueries/{{username}}/1','queriesdiv', 1);	
      renderDealResults('/getdeals/{{username}}/-1/-1/-1/1/30/getdeals.html','dealresultsdiv', -1, 0, 1 );
	  renderMapResults('/getdeals/{{username}}/-1/-1/-1/1/30/getmap.html','mapresultsdiv', -1, 0, 1 );
	 
	  
	  {% if qlen > 0 %}
		  renderURLinDiv('/getfilters/{{first_query['_id']}}/-1','filtersdiv',false);
		  renderPriceSlider({{first_query['pricemax']}},{{first_query['pricemin']}},{{first_query['price_high']}},{{first_query['price_low']}});
		  renderDaysSlider({{first_query['dayfilter']}});
	{% endif %}
	 
	 
	 
	 
      renderQueryBox('/getpopularqueries/{{username}}/1','popularqueriesdiv', 1);
     
	
      
     
      // Functions to handle submit of a new query
      $("#add_query").bind("submit", function(e){
     	 e.preventDefault();
      });
      
      $('#add_query').submit(function() {
      	  renderProgressBar();
      	  doAnimation();
	      var keyword = $("#keyword").val();
	      var dollar_limit = parseInt($("#dollar_limit").val());
	      var price_high = dollar_limit + parseInt({{PRICE_HIGH_PER}} * dollar_limit);
		  var price_low = dollar_limit - parseInt({{PRICE_LOW_PER}} * dollar_limit);
		  var price_max = parseInt({{PRICE_MAX_PER}} * price_high);
		  var price_min = parseInt(price_low / {{PRICE_MIN_PER}});
	      addQuery('/addquery/' + keyword + '/' + dollar_limit);
	      totalqueries = totalqueries + 1;
	      renderQueryBox('/getqueries/{{username}}/' + totalqueries.toString(),'queriesdiv', 1);
	      renderURLinDiv('/getfilters/-1/' + totalqueries.toString(),'filtersdiv',false);
	  	  renderPriceSlider(price_max, price_min, price_high, price_low);
	      renderDaysSlider({{DEFAULT_DAYS_FILTER}});
	      renderDealResults('/getdeals/' + keyword + '/' + dollar_limit + '/' + price_high + '/' + price_low + '/1/30/getdeals.html','dealresultsdiv', -1, 0, 1 );
	      
	      renderMapResults('/getdeals/' + keyword + '/' + dollar_limit + '/' + price_high + '/' + price_low + '/1/30/getmap.html','mapresultsdiv', -1, 0, 1 );

	      
	      $('#keyword').val('');
	      $('#dollar_limit').val('');
	      

      });
      
      function recordOutboundLink(link) {
    		_gaq.push(['_trackEvent', 'deals', 'click', 'knoponpage']);
    		setTimeout('document.location = "' + link.href + '"', 100);
  	  }
      
    
    </script>
    
    <script src="/bootstrap/docs/assets/js/bootstrap-transition.js"></script>
    <script src="/bootstrap/docs/assets/js/bootstrap-alert.js"></script>
    <script src="/bootstrap/docs/assets/js/bootstrap-modal.js"></script>
    <script src="/bootstrap/docs/assets/js/bootstrap-dropdown.js"></script>

    <script src="/bootstrap/docs/assets/js/bootstrap-scrollspy.js"></script>
    <script src="/bootstrap/docs/assets/js/bootstrap-tab.js"></script>
    <script src="/bootstrap/docs/assets/js/bootstrap-tooltip.js"></script>
    <script src="/bootstrap/docs/assets/js/bootstrap-popover.js"></script>
    <script src="/bootstrap/docs/assets/js/bootstrap-button.js"></script>
    <script src="/bootstrap/docs/assets/js/bootstrap-collapse.js"></script>

    <script src="/bootstrap/docs/assets/js/bootstrap-carousel.js"></script>
    <script src="/bootstrap/docs/assets/js/bootstrap-typeahead.js"></script>

		  
	<script src="/jquery-ui-1.8.21.custom/development-bundle/ui/jquery.ui.core.js"></script>
	<script src="/jquery-ui-1.8.21.custom/development-bundle/ui/jquery.ui.widget.js"></script>
	<script src="/jquery-ui-1.8.21.custom/development-bundle/ui/jquery.ui.mouse.js"></script>
	<script src="/jquery-ui-1.8.21.custom/development-bundle/ui/jquery.ui.slider.js"></script>


</body></html>
 {% endblock %}	